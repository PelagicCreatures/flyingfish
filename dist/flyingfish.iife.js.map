{"version":3,"file":"flyingfish.iife.js","sources":["../lib/FlyingFish.js"],"sourcesContent":["import {\n\tSargasso, utils\n}\n\tfrom '@pelagiccreatures/sargasso'\n\nclass FlyingFish extends Sargasso {\n\tconstructor (element, options = {}) {\n\t\tsuper(element, {\n\t\t\twatchViewport: true\n\t\t})\n\t\tthis.triggered = false\n\t}\n\n\tenterViewport () {\n\t\tif (!this.triggered) {\n\t\t\tthis.triggered = true\n\n\t\t\tconst offload = `onmessage = async (e) => {\n\t\t\t  const response = await fetch(e.data.url)\n\t\t\t\tconst contentType = response.headers.get('content-type');\n\t\t\t  const blob = await response.blob()\n\t\t\t  self.postMessage({ uid: e.data.uid, blob: blob, contentType: contentType})\n\t\t\t}`\n\n\t\t\tthis.workerStart('FlyingFish', offload)\n\n\t\t\tlet imgUrl = this.element.getAttribute('data-src')\n\n\t\t\t// not fully qualified...\n\t\t\tif (!imgUrl.match(/^http/)) {\n\t\t\t\timgUrl = new URL(imgUrl, location.href).href\n\t\t\t}\n\n\t\t\t// hand the url to the worker for loading\n\t\t\tthis.workerPostMessage('FlyingFish', {\n\t\t\t\turl: imgUrl\n\t\t\t})\n\t\t}\n\t}\n\n\t// we got a message back from a worker\n\tworkerOnMessage (id, data) {\n\t\tif (id === 'FlyingFish') {\n\t\t\tthis.blobURL = URL.createObjectURL(data.blob)\n\t\t\tconst frame = () => {\n\t\t\t\tif (this.element.tagName === 'IMG') {\n\t\t\t\t\tthis.element.setAttribute('src', this.blobURL)\n\t\t\t\t} else {\n\t\t\t\t\tthis.element.style.backgroundImage = 'url(' + this.blobURL + ')'\n\t\t\t\t}\n\t\t\t\tthis.sleep() // We're done. That was easy.\n\t\t\t}\n\t\t\tthis.queueFrame(frame)\n\t\t}\n\t\tsuper.workerOnMessage(id, data)\n\t}\n\n\tdestroy () {\n\t\tif (this.blobURL) {\n\t\t\tURL.revokeObjectURL(this.blobURL)\n\t\t}\n\t\tsuper.destroy()\n\t}\n}\n\nutils.registerSargassoClass('FlyingFish', FlyingFish)\n\nexport {\n\tFlyingFish\n}\n"],"names":["Sargasso","utils"],"mappings":";;;;CAKA,MAAM,UAAU,SAASA,iBAAQ,CAAC;CAClC,CAAC,WAAW,CAAC,CAAC,OAAO,EAAE,OAAO,GAAG,EAAE,EAAE;CACrC,EAAE,KAAK,CAAC,OAAO,EAAE;CACjB,GAAG,aAAa,EAAE,IAAI;CACtB,GAAG,EAAC;CACJ,EAAE,IAAI,CAAC,SAAS,GAAG,MAAK;CACxB,EAAE;AACF;CACA,CAAC,aAAa,CAAC,GAAG;CAClB,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;CACvB,GAAG,IAAI,CAAC,SAAS,GAAG,KAAI;AACxB;CACA,GAAG,MAAM,OAAO,GAAG,CAAC;AACpB;AACA;AACA;AACA;AACA,IAAI,EAAC;AACL;CACA,GAAG,IAAI,CAAC,WAAW,CAAC,YAAY,EAAE,OAAO,EAAC;AAC1C;CACA,GAAG,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,UAAU,EAAC;AACrD;CACA;CACA,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE;CAC/B,IAAI,MAAM,GAAG,IAAI,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,KAAI;CAChD,IAAI;AACJ;CACA;CACA,GAAG,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE;CACxC,IAAI,GAAG,EAAE,MAAM;CACf,IAAI,EAAC;CACL,GAAG;CACH,EAAE;AACF;CACA;CACA,CAAC,eAAe,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE;CAC5B,EAAE,IAAI,EAAE,KAAK,YAAY,EAAE;CAC3B,GAAG,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,EAAC;CAChD,GAAG,MAAM,KAAK,GAAG,MAAM;CACvB,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,KAAK,EAAE;CACxC,KAAK,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,EAAC;CACnD,KAAK,MAAM;CACX,KAAK,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,GAAG,IAAI,CAAC,OAAO,GAAG,IAAG;CACrE,KAAK;CACL,IAAI,IAAI,CAAC,KAAK,GAAE;CAChB,KAAI;CACJ,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAC;CACzB,GAAG;CACH,EAAE,KAAK,CAAC,eAAe,CAAC,EAAE,EAAE,IAAI,EAAC;CACjC,EAAE;AACF;CACA,CAAC,OAAO,CAAC,GAAG;CACZ,EAAE,IAAI,IAAI,CAAC,OAAO,EAAE;CACpB,GAAG,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,EAAC;CACpC,GAAG;CACH,EAAE,KAAK,CAAC,OAAO,GAAE;CACjB,EAAE;CACF,CAAC;AACD;AACAC,eAAK,CAAC,qBAAqB,CAAC,YAAY,EAAE,UAAU;;;;;;;;;;"}